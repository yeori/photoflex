!function(n,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.photoflex=t():n.photoflex=t()}(self,(function(){return(()=>{"use strict";var n={387:(n,t,e)=>{e.d(t,{Z:()=>c});var r=e(15),o=e.n(r),i=e(645),a=e.n(i)()(o());a.push([n.id,"[data-photoflex-container]{padding:30px;position:relative;text-align:center;background-color:#ececec}[data-photoflex-container] .canvas-wrapper{display:inline-block;background-color:#fff;line-height:1;box-shadow:rgba(14,30,37,.12) 0px 2px 4px 0px,rgba(14,30,37,.32) 0px 2px 16px 0px;position:relative}[data-photoflex-container] .canvas-wrapper canvas{display:block;cursor:all-scroll}[data-photoflex-container] .canvas-wrapper .selection{position:absolute;width:300px;height:300px;outline:1px solid transparent;z-index:10;cursor:pointer;display:flex;align-items:center;justify-content:center}[data-photoflex-container] .canvas-wrapper .selection.viewport{border-color:red;outline-color:red}[data-photoflex-container] .canvas-wrapper .selection.viewport .box{background-color:red;border-color:inherit}[data-photoflex-container] .canvas-wrapper .selection.viewport .btn-icon{background-color:red}[data-photoflex-container] .canvas-wrapper .selection.image{border-color:#23ae3a;outline-color:#23ae3a}[data-photoflex-container] .canvas-wrapper .selection.image .box{background-color:#23ae3a;border-color:inherit}[data-photoflex-container] .canvas-wrapper .selection.image .btn-icon{background-color:#23ae3a}[data-photoflex-container] .canvas-wrapper .selection button{margin:0}[data-photoflex-container] .canvas-wrapper .selection .btn-icon{border:none;line-height:1;padding:4px;border-radius:50px;color:#ccc;opacity:.7;display:none}[data-photoflex-container] .canvas-wrapper .selection .btn-icon:hover{opacity:.8}[data-photoflex-container] .canvas-wrapper .selection .btn-move{position:absolute;top:0;left:0;transform:translateX(-110%);display:none;cursor:all-scroll}[data-photoflex-container] .canvas-wrapper .selection .btn-resizer{position:absolute;bottom:0;left:100%;cursor:se-resize;transform:translate(10%, 10%)}[data-photoflex-container] .canvas-wrapper .selection .btn-resizer>svg{transform:rotate(-45deg)}[data-photoflex-container] .canvas-wrapper .selection .size-box{position:absolute;top:100%;left:-1px;box-sizing:border-box;display:flex}[data-photoflex-container] .canvas-wrapper .selection .size-box .size-text{user-select:none;font-size:12px;padding:8px;border:1px solid inherit;color:#fff;white-space:nowrap}[data-photoflex-container] .canvas-wrapper .selection .size-box .btn-range-lock{background-color:transparent;border:none;background-color:inherit}[data-photoflex-container] .canvas-wrapper .selection .area-box{position:absolute;top:0;right:-1px;transform:translate(0, -100%);box-sizing:border-box;display:flex}[data-photoflex-container] .canvas-wrapper .selection .area-box .area-text{user-select:none;font-size:12px;padding:8px;background-color:inherit;border:1px solid inherit;color:#fff;white-space:nowrap}[data-photoflex-container] .canvas-wrapper .selection.editing .btn-icon{display:flex;color:#fff}[data-photoflex-container] .range-bg{position:absolute;top:0;left:0;right:0;bottom:0;display:flex;align-items:center;justify-content:center;background-color:#0000004d;font-size:.85rem;z-index:100}[data-photoflex-container] .range-bg .range-box{background-color:#fff;min-width:260px;text-align:left}[data-photoflex-container] .range-bg .range-box>h3{margin:0;padding:10px 20px}[data-photoflex-container] .range-bg .range-box .range-list{list-style:none;padding:0;margin:0;cursor:pointer}[data-photoflex-container] .range-bg .range-box .range-list>li{padding:5px 20px}[data-photoflex-container] .range-bg .range-box .range-list>li.active{background-color:#cff4ff}[data-photoflex-container] .range-bg .range-box .range-list>li:hover{background-color:#f0f8ff}[data-photoflex-container] .range-bg .range-box .range-input{padding:0px 20px 10px;display:flex;border-bottom:1px solid #cdcdcd}[data-photoflex-container] .range-bg .range-box .range-input>input{margin-right:4px}[data-photoflex-container] .range-bg .range-box .footer{padding:10px 20px;border-top:1px solid #cdcdcd;text-align:right}","",{version:3,sources:["webpack://./src/photoflex.scss"],names:[],mappings:"AAAA,2BACE,YAAA,CACA,iBAAA,CACA,iBAAA,CACA,wBAAA,CAEA,2CACE,oBAAA,CACA,qBAAA,CACA,aAAA,CACA,iFAAA,CAEA,iBAAA,CACA,kDACE,aAAA,CACA,iBAAA,CAEF,sDACE,iBAAA,CACA,WAAA,CACA,YAAA,CACA,6BAAA,CACA,UAAA,CACA,cAAA,CACA,YAAA,CACA,kBAAA,CACA,sBAAA,CACA,+DACE,gBAAA,CACA,iBAAA,CACA,oEACE,oBAAA,CACA,oBAAA,CAEF,yEACE,oBAAA,CAGJ,4DACE,oBAAA,CACA,qBAAA,CACA,iEACE,wBAAA,CACA,oBAAA,CAEF,sEACE,wBAAA,CAGJ,6DACE,QAAA,CAEF,gEACE,WAAA,CACA,aAAA,CACA,WAAA,CACA,kBAAA,CACA,UAAA,CACA,UAAA,CACA,YAAA,CACA,sEACE,UAAA,CAGJ,gEACE,iBAAA,CACA,KAAA,CACA,MAAA,CACA,2BAAA,CACA,YAAA,CACA,iBAAA,CAEF,mEACE,iBAAA,CACA,QAAA,CACA,SAAA,CACA,gBAAA,CACA,6BAAA,CACA,uEACE,wBAAA,CAGJ,gEACE,iBAAA,CACA,QAAA,CACA,SAAA,CACA,qBAAA,CACA,YAAA,CAGA,2EACE,gBAAA,CACA,cAAA,CACA,WAAA,CACA,wBAAA,CACA,UAAA,CACA,kBAAA,CAEF,gFACE,4BAAA,CACA,WAAA,CACA,wBAAA,CAGJ,gEACE,iBAAA,CACA,KAAA,CACA,UAAA,CACA,6BAAA,CACA,qBAAA,CACA,YAAA,CACA,2EACE,gBAAA,CACA,cAAA,CACA,WAAA,CACA,wBAAA,CACA,wBAAA,CACA,UAAA,CACA,kBAAA,CAIF,wEACE,YAAA,CACA,UAAA,CAKR,qCACE,iBAAA,CACA,KAAA,CACA,MAAA,CACA,OAAA,CACA,QAAA,CACA,YAAA,CACA,kBAAA,CACA,sBAAA,CACA,0BAAA,CACA,gBAAA,CACA,WAAA,CACA,gDACE,qBAAA,CACA,eAAA,CACA,eAAA,CACA,mDACE,QAAA,CACA,iBAAA,CAEF,4DACE,eAAA,CACA,SAAA,CACA,QAAA,CACA,cAAA,CACA,+DACE,gBAAA,CACA,sEACE,wBAAA,CAEF,qEACE,wBAAA,CAIN,6DACE,qBAAA,CACA,YAAA,CACA,+BAAA,CACA,mEACE,gBAAA,CAGJ,wDACE,iBAAA,CACA,4BAAA,CACA,gBAAA",sourcesContent:["[data-photoflex-container] {\n  padding: 30px;\n  position: relative;\n  text-align: center;\n  background-color: #ececec;\n\n  .canvas-wrapper {\n    display: inline-block;\n    background-color: white;\n    line-height: 1;\n    box-shadow: rgba(14, 30, 37, 0.12) 0px 2px 4px 0px,\n      rgba(14, 30, 37, 0.32) 0px 2px 16px 0px;\n    position: relative;\n    canvas {\n      display: block;\n      cursor: all-scroll;\n    }\n    .selection {\n      position: absolute;\n      width: 300px;\n      height: 300px;\n      outline: 1px solid transparent;\n      z-index: 10;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      &.viewport {\n        border-color: red;\n        outline-color: red;\n        .box {\n          background-color: red;\n          border-color: inherit;\n        }\n        .btn-icon {\n          background-color: red;\n        }\n      }\n      &.image {\n        border-color: #23ae3a;\n        outline-color: #23ae3a;\n        .box {\n          background-color: #23ae3a;\n          border-color: inherit;\n        }\n        .btn-icon {\n          background-color: #23ae3a;\n        }\n      }\n      button {\n        margin: 0;\n      }\n      .btn-icon {\n        border: none;\n        line-height: 1;\n        padding: 4px;\n        border-radius: 50px;\n        color: #ccc;\n        opacity: 0.7;\n        display: none;\n        &:hover {\n          opacity: 0.8;\n        }\n      }\n      .btn-move {\n        position: absolute;\n        top: 0;\n        left: 0;\n        transform: translateX(-110%);\n        display: none;\n        cursor: all-scroll;\n      }\n      .btn-resizer {\n        position: absolute;\n        bottom: 0;\n        left: 100%;\n        cursor: se-resize;\n        transform: translate(10%, 10%);\n        & > svg {\n          transform: rotate(-45deg);\n        }\n      }\n      .size-box {\n        position: absolute;\n        top: 100%;\n        left: -1px;\n        box-sizing: border-box;\n        display: flex;\n        // background-color: red;\n        // border-color: red;\n        .size-text {\n          user-select: none;\n          font-size: 12px;\n          padding: 8px;\n          border: 1px solid inherit;\n          color: white;\n          white-space: nowrap;\n        }\n        .btn-range-lock {\n          background-color: transparent;\n          border: none;\n          background-color: inherit;\n        }\n      }\n      .area-box {\n        position: absolute;\n        top: 0;\n        right: -1px;\n        transform: translate(0, -100%);\n        box-sizing: border-box;\n        display: flex;\n        .area-text {\n          user-select: none;\n          font-size: 12px;\n          padding: 8px;\n          background-color: inherit;\n          border: 1px solid inherit;\n          color: white;\n          white-space: nowrap;\n        }\n      }\n      &.editing {\n        .btn-icon {\n          display: flex;\n          color: white;\n        }\n      }\n    }\n  }\n  .range-bg {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background-color: #0000004d;\n    font-size: 0.85rem;\n    z-index: 100;\n    .range-box {\n      background-color: white;\n      min-width: 260px;\n      text-align: left;\n      & > h3 {\n        margin: 0;\n        padding: 10px 20px;\n      }\n      .range-list {\n        list-style: none;\n        padding: 0;\n        margin: 0;\n        cursor: pointer;\n        & > li {\n          padding: 5px 20px;\n          &.active {\n            background-color: #cff4ff;\n          }\n          &:hover {\n            background-color: aliceblue;\n          }\n        }\n      }\n      .range-input {\n        padding: 0px 20px 10px;\n        display: flex;\n        border-bottom: 1px solid #cdcdcd;\n        & > input {\n          margin-right: 4px;\n        }\n      }\n      .footer {\n        padding: 10px 20px;\n        border-top: 1px solid #cdcdcd;\n        text-align: right;\n      }\n    }\n  }\n}\n"],sourceRoot:""}]);const c=a},645:n=>{n.exports=function(n){var t=[];return t.toString=function(){return this.map((function(t){var e=n(t);return t[2]?"@media ".concat(t[2]," {").concat(e,"}"):e})).join("")},t.i=function(n,e,r){"string"==typeof n&&(n=[[null,n,""]]);var o={};if(r)for(var i=0;i<this.length;i++){var a=this[i][0];null!=a&&(o[a]=!0)}for(var c=0;c<n.length;c++){var s=[].concat(n[c]);r&&o[s[0]]||(e&&(s[2]?s[2]="".concat(e," and ").concat(s[2]):s[2]=e),t.push(s))}},t}},15:n=>{function t(n,t){(null==t||t>n.length)&&(t=n.length);for(var e=0,r=new Array(t);e<t;e++)r[e]=n[e];return r}n.exports=function(n){var e,r,o=(r=4,function(n){if(Array.isArray(n))return n}(e=n)||function(n,t){var e=null==n?null:"undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null!=e){var r,o,i=[],a=!0,c=!1;try{for(e=e.call(n);!(a=(r=e.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(n){c=!0,o=n}finally{try{a||null==e.return||e.return()}finally{if(c)throw o}}return i}}(e,r)||function(n,e){if(n){if("string"==typeof n)return t(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);return"Object"===r&&n.constructor&&(r=n.constructor.name),"Map"===r||"Set"===r?Array.from(n):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(n,e):void 0}}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[1],a=o[3];if(!a)return i;if("function"==typeof btoa){var c=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),s="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(c),l="/*# ".concat(s," */"),u=a.sources.map((function(n){return"/*# sourceURL=".concat(a.sourceRoot||"").concat(n," */")}));return[i].concat(u).concat([l]).join("\n")}return[i].join("\n")}},379:n=>{var t=[];function e(n){for(var e=-1,r=0;r<t.length;r++)if(t[r].identifier===n){e=r;break}return e}function r(n,r){for(var i={},a=[],c=0;c<n.length;c++){var s=n[c],l=r.base?s[0]+r.base:s[0],u=i[l]||0,A="".concat(l," ").concat(u);i[l]=u+1;var p=e(A),h={css:s[1],media:s[2],sourceMap:s[3]};-1!==p?(t[p].references++,t[p].updater(h)):t.push({identifier:A,updater:o(h,r),references:1}),a.push(A)}return a}function o(n,t){var e=t.domAPI(t);return e.update(n),function(t){if(t){if(t.css===n.css&&t.media===n.media&&t.sourceMap===n.sourceMap)return;e.update(n=t)}else e.remove()}}n.exports=function(n,o){var i=r(n=n||[],o=o||{});return function(n){n=n||[];for(var a=0;a<i.length;a++){var c=e(i[a]);t[c].references--}for(var s=r(n,o),l=0;l<i.length;l++){var u=e(i[l]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}i=s}}},569:n=>{var t={};n.exports=function(n,e){var r=function(n){if(void 0===t[n]){var e=document.querySelector(n);if(window.HTMLIFrameElement&&e instanceof window.HTMLIFrameElement)try{e=e.contentDocument.head}catch(n){e=null}t[n]=e}return t[n]}(n);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(e)}},216:n=>{n.exports=function(n){var t=document.createElement("style");return n.setAttributes(t,n.attributes),n.insert(t),t}},565:(n,t,e)=>{n.exports=function(n){var t=e.nc;t&&n.setAttribute("nonce",t)}},795:n=>{n.exports=function(n){var t=n.insertStyleElement(n);return{update:function(e){!function(n,t,e){var r=e.css,o=e.media,i=e.sourceMap;o?n.setAttribute("media",o):n.removeAttribute("media"),i&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleTagTransform(r,n)}(t,n,e)},remove:function(){!function(n){if(null===n.parentNode)return!1;n.parentNode.removeChild(n)}(t)}}}},589:n=>{n.exports=function(n,t){if(t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}}},t={};function e(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={id:r,exports:{}};return n[r](i,i.exports,e),i.exports}e.n=n=>{var t=n&&n.__esModule?()=>n.default:()=>n;return e.d(t,{a:t}),t},e.d=(n,t)=>{for(var r in t)e.o(t,r)&&!e.o(n,r)&&Object.defineProperty(n,r,{enumerable:!0,get:t[r]})},e.o=(n,t)=>Object.prototype.hasOwnProperty.call(n,t),e.r=n=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})};var r={};return(()=>{function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(t)}function t(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function o(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function i(n,t,e){return t&&o(n.prototype,t),e&&o(n,e),n}e.r(r),e.d(r,{default:()=>In,init:()=>jn});var a=function(){function n(e){t(this,n),this.expression=e}return i(n,[{key:"isClass",get:function(){return"."===this.expression.charAt(0)}},{key:"isId",get:function(){return"#"===this.expression.charAt(0)}},{key:"value",get:function(){return this.expression.substring(1)}},{key:"setAttribute",value:function(n){if(this.isId)n.setAttribute("id",this.value);else{if(!this.isClass)throw new Error("neither id nor class : [".concat(this.expression,"]"));n.classList.add(this.value)}}}]),n}(),c=new Set,s=function(){function n(){t(this,n),this.callbacks=new Map}return i(n,[{key:"on",value:function(n,t){var e=this.callbacks.get(n);e||(e=new Set,this.callbacks.set(n,e)),e.add(t)}},{key:"emit",value:function(n,t){(this.callbacks.get(n)||c).forEach((function(n){try{n(t)}catch(n){console.log(n)}}))}}]),n}(),l=function(n,t){if(1===n.nodeType)return n.closest(t);if(3===n.nodeType)return n.parentElement.closest(t);throw new Error("node type ".concat(n.nodeTye,", tag(").concat(n.nodeName,")"))},u=function(n){return(n||"").split(" ").map((function(n){return n.trim()})).filter((function(n){return n.length>0}))},A=function(n,t){var e=document.createElement(n);return t.forEach((function(n){new a(n).setAttribute(e)})),e},p=function(n,t,e,r){(n||window).addEventListener(t,e,r)},h=function(n){return n.stopPropagation()};const f=function(n,t){var e=A("span",u(n));return t&&(e.innerHTML=t),e},d=function(n,t){var e=A("BUTTON",u(n));return e.innerHTML=t,e},g=function(n){var t=document.createElement("img");return new Promise((function(e){t.addEventListener("load",(function(){e({img:t,width:600,height:600})})),t.src=n}))},v=function(n){return A("DIV",u(n))},b=function(n){return A("CANVAS",u(n))},x=l,C=function(){return new s},y=function(n,t){n.addEventListener(t,h)},m=function(n,t,e){p(t,"mousedown",n,e)},w=function(n,t,e){p(t,"mousemove",n,e)},E=function(n,t,e){p(t,"mouseup",n,e)},$=function(n,t,e){p(t,"touchstart",n,e)},k=function(n,t,e){p(t,"touchmove",n,e)},B=function(n,t,e){p(t,"touchend",n,e)},z=function(n,t,e){p(n,"click",t,e)},O=function(t,e){var r={width:function(t){return"number"===n(t)?"".concat(t,"px"):t}};r.height=r.width,Object.keys(e).forEach((function(n){var o=(r[n]||function(n){return n})(e[n]);t.style[n]=o}))},S=function(n,t){var e=n;Object.keys(t).forEach((function(n){var r="@"+n,o=t[n];e=e.replaceAll(r,o)}));var r=document.createElement("template");return r.innerHTML=e,r.content.firstElementChild},j=function(n,t){return n.querySelector(t)},I=function(n,t,e){var r=n.matches(t);if(r)return e(n),r;var o=l(n,t);return!!o&&(e(o),!0)},T=function(n,t){var e={};return t.forEach((function(t){var r=n.dataset[t];e[t]=parseInt(r,10)})),e};var D=function(){},M=function(n){var t=n.touches[0];"touchend"===n.type&&(t=n.changedTouches[0]),n.clientX=t.clientX,n.clientY=t.clientY,n.layerX=0,n.layerY=0,n.offsetX=0,n.offsetY=0,n.pageX=t.pageX,n.pageY=t.pageY,n.screenX=t.screenX,n.screenY=t.screenY},P=function(n,t){var e=n.ctx;n.handler.accept(t.target)&&(e.dragging={originalEvent:t,sx:t.pageX,sy:t.pageY,dx:0,dy:0},n.beforeDrag(e.dragging,e.payload))},H=function(n,t){var e=n.ctx;e.dragging&&(t.preventDefault(),e.originalEvent=t,e.originalEvent=t,e.dragging.dx=t.pageX-e.dragging.sx,e.dragging.dy=t.pageY-e.dragging.sy,n.dragging(e.dragging,e.payload))},L=function(n,t){var e=n.ctx;try{e.dragging&&(e.originalEvent=t,document.querySelector("body").style.cursor="",n.afterDrag(e.dragging,e.payload))}catch(n){console.log("[DND error]",n)}finally{e.dragging=null}},U=function(n){clearTimeout(n.touchTimer),n.touchTimer=null},W=function n(t,e){var r=this;!function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.$$={},this.ctx={payload:e,dragging:null},this.handler=t,this.beforeDrag=t.beforeDrag||D,this.dragging=t.dragging||D,this.afterDrag=t.afterDrag||D,m((function(n){return P(r,n)}),window),w((function(n){return H(r,n)}),window),E((function(n){return L(r,n)}),window),$((function(n){return function(n,t){n.ctx.touchTimer=setTimeout((function(){M(t),P(n,t)}),100)}(r,n)}),window),k((function(n){return function(n,t){var e=n.ctx;U(e),M(t),H(n,t)}(r,n)}),window,{passive:!1}),B((function(n){return function(n,t){var e=n.ctx;U(e),M(t),L(n,t)}(r,n)}),window)};function Y(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function R(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function V(n,t,e){return t&&R(n.prototype,t),e&&R(n,e),n}var F=function(n,t,e){var r=n.canvasWidth,o=n.canvasHeight,i={x:(e.width*t-r)/2,y:(e.height*t-o)/2,width:r,height:o,ratio:t},a={x:i.x/t,y:i.y/t,width:i.width/t,height:i.height/t};return n.config.ratio=t,{canvas:i,image:a}},q={cover:function(n,t,e){var r=n.canvasWidth,o=n.canvasHeight,i=e.width,a=e.height;return F(n,o/r<=a/i?r/i:o/a,e)},contain:function(n,t,e){var r=n.canvasWidth,o=n.canvasHeight,i=e.width,a=e.height;return F(n,o/r<=a/i?o/a:r/i,e)},none:F},X={viewport:function(n,t){var e=n.ctx.getImageData(t.x,t.y,t.width,t.height),r=document.createElement("canvas");return r.width=t.width,r.height=t.height,r.getContext("2d").putImageData(e,0,0),r.toDataURL()},image:function(n,t){var e=n.$$,r=e.viewport,o=e.source,i=r.image,a=r.canvas.ratio,c={x:t.x/a+i.x,y:t.y/a+i.y,width:t.width/a,height:t.height/a},s=o.capture(c),l=document.createElement("canvas");return l.width=Math.min(s.width),l.height=Math.min(s.height),l.getContext("2d").putImageData(s,0,0),l.toDataURL()}};function N(n){var t,e;return{accept:function(t){return t===n.$$.canvasEl},beforeDrag:function(){t=n.$$.viewport.canvas.x,e=n.$$.viewport.canvas.y},dragging:function(r){n.$$.viewport.canvas.x=t-r.dx,n.$$.viewport.canvas.y=e-r.dy,n.repaint()},afterDrag:function(){var t=n.$$.viewport,e=t.canvas.ratio;t.image.x=t.canvas.x/e,t.image.y=t.canvas.y/e}}}var J=function(){function n(t,e){Y(this,n),this.image=t,this.meta=e,this.$$={canvas:null,ctx:null};var r=b();r.width=e.width,r.height=e.height;var o=r.getContext("2d");o.drawImage(t,0,0),this.$$.canvas=r,this.$$.ctx=o}return V(n,[{key:"capture",value:function(n){return this.$$.ctx.getImageData(n.x,n.y,n.width,n.height)}}]),n}();const G=function(){function n(t,e,r){var o=this;Y(this,n),this.parentEl=t,this.config=e,this.ctx=null,this.$$={viewport:null,source:null},this.injectCanvas(),this.$$.dnd=new W(new N(this)),this.eventBus=r,r.on("config-updated",(function(n){var t=n.key;if("ratio"===t||"fitMode"===t||"captureOn"===t){var e=o.config,r=e.ratio,i=e.fitMode;o.$$.viewport=q[i](o,r,o.$$.source.meta),o.repaint(),o.eventBus.emit("viewport",o.$$.viewport)}}))}return V(n,[{key:"injectCanvas",value:function(){var n=b();this.$$.canvasEl=n,n.width=this.canvasWidth,n.height=this.canvasHeight,this.ctx=n.getContext("2d"),this.parentEl.appendChild(n),this.repaint()}},{key:"clearCanvas",value:function(n){n.clearRect(0,0,this.canvasWidth,this.canvasHeight)}},{key:"copyImageAt",value:function(n){var t=this.config.captureOn;return X[t](this,n)}},{key:"wrapperEl",value:function(){return this.$$.wrapperEl}},{key:"renderImage",value:function(n){if(this.$$.source){var t=this.$$.source.image,e=this.$$.viewport,r=e.canvas.ratio,o=e.canvas.x<0?-e.canvas.x:0,i=e.canvas.y<0?-e.canvas.y:0;n.drawImage(t,(e.canvas.x+o)/r,(e.canvas.y+i)/r,e.canvas.width/r,e.canvas.height/r,o,i,this.canvasWidth,this.canvasHeight)}}},{key:"setImage",value:function(n,t){this.$$.source=new J(n,t);var e=this.config,r=e.ratio,o=e.fitMode;this.$$.viewport=q[o](this,r,t),this.eventBus.emit("viewport",this.$$.viewport),this.repaint()}},{key:"repaint",value:function(){var n=this.ctx;this.clearCanvas(n),this.renderImage(n)}},{key:"canvasWidth",get:function(){return n=this.parentEl,this.config.width,n.offsetWidth;var n}},{key:"canvasHeight",get:function(){return this.config.height}},{key:"image",get:function(){return this.$$.source.image}}]),n}();function Q(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}var Z,K=function(n,t,e){var r=parseInt(t.width,10),o=parseInt(t.height,10);n.innerHTML=e(r,o)},_={x:0,y:0,parent:null},nn={accept:function(n){return!!x(n,".btn-move")},beforeDrag:function(){_.x=Z.offsetLeft,_.y=Z.offsetTop,_.width=Z.offsetWidth,_.height=Z.offsetHeight,_.parent={width:Z.parentElement.offsetWidth,height:Z.parentElement.offsetHeight}},dragging:function(n,t){var e=t.selection,r=Math.max(0,_.x+n.dx),o=Math.max(0,_.y+n.dy);r=Math.min(r,_.parent.width-_.width),o=Math.min(o,_.parent.height-_.height),e.selection.x=r,e.selection.y=o,e.repaint()},afterDrag:function(){}};function tn(n){var t,e;return{accept:function(t){return x(t,".btn-resizer")===n.$$.btnResize},beforeDrag:function(){t=n.selection.width,e=n.selection.height},dragging:function(r){n.selection.width=t+r.dx,n.selection.height=e+r.dy,n.repaint()},afterDrag:function(){}}}const en=function(){function n(t,e,r){var o=this;!function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.$$={parent:t,editing:!0},this.config=e,this.eventBus=r,Z=this.prepareEl(),this.setVisible(!1),this.dnd=new W(nn,{selection:this}),this.resizeDnd=new W(new tn(this)),this.repaint(),this.eventBus.on("config-updated",(function(n){var t=n.key;n.value,"captureOn"!==t&&"range"!==t&&"fitMode"!==t||o.repaint()})),this.eventBus.on("viewport",(function(n){console.log("[VIEWPORT]",n),o.repaint()}))}var t,e;return t=n,(e=[{key:"selection",get:function(){return this.config.range}},{key:"ranges",get:function(){return this.config.ranges}},{key:"captureOn",get:function(){return this.config.captureOn}},{key:"setVisible",value:function(n){this.visible=n;var t=this.visible?"":"none";O(this.$$.el,{display:t})}},{key:"prepareEl",value:function(){var n=this,t=this.$$.parent,e=v(".selection .editing .viewport");this.$$.el=e;var r=d(".btn-move .btn-icon",'<svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 0 24 24" width="18px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"/></svg>');y(r,"click"),e.appendChild(r),t.appendChild(e);var o=d(".btn-icon .btn-resizer",'<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="18px" viewBox="0 0 24 24" width="18px" fill="currentColor"><g><rect fill="none" height="24" width="24"/></g><g><g/><polygon points="13,6.99 16,6.99 12,3 8,6.99 11,6.99 11,17.01 8,17.01 12,21 16,17.01 13,17.01"/></g></svg>');e.appendChild(o),this.$$.btnResize=o;var i=v(".size-box .box");this.$$.sizeEl=i,this.$$.sizeText=f(".size-text"),i.appendChild(this.$$.sizeText),i.appendChild(d(".btn-range-lock",'<svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 0 24 24" width="16px" fill="currentColor"><g fill="none"><path d="M0 0h24v24H0V0z"/><path d="M0 0h24v24H0V0z" opacity=".87"/></g><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6zm9 14H6V10h12v10zm-6-3c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2z"/></svg>')),z(this.$$.sizeText,(function(t){t.stopPropagation(),n.eventBus.emit("sizebox",n.selection)})),e.appendChild(i);var a=this.$$.areaEl=v(".area-box .box"),c=this.$$.areaText=f(".area-text");return a.appendChild(c),e.appendChild(a),e}},{key:"mergeSelection",value:function(n){var t=n.x,e=n.y,r=n.width,o=n.height;this.selection.x=t||this.selection.x,this.selection.y=e||this.selection.y,this.selection.width=r||this.selection.y,this.selection.height=o||this.selection.height,this.repaint()}},{key:"repaint",value:function(){if(this.selection){t=this.$$.el,e=this.selection,r=this.captureOn,t.style.left="".concat(e.x,"px"),t.style.top="".concat(e.y,"px"),t.style.width="".concat(e.width,"px"),t.style.height="".concat(e.height,"px"),t.classList.remove("viewport"),t.classList.remove("image"),t.classList.add(r),K(this.$$.sizeText,this.selection,(function(n,t){return"".concat(n," x ").concat(t)}));var n="image"===this.captureOn?this.config.ratio:1;K(this.$$.areaText,this.selection,(function(t,e){return"".concat(parseInt(t/n)," x ").concat(parseInt(e/n))}))}var t,e,r}}])&&Q(t.prototype,e),n}();function rn(n,t){(null==t||t>n.length)&&(t=n.length);for(var e=0,r=new Array(t);e<t;e++)r[e]=n[e];return r}var on,an,cn,sn=function(){var n=j(on,".range-list");n.replaceChildren(),an.options.forEach((function(t,e){var r=t.width,o=t.height,i="".concat(r,"x").concat(o),a=S('<li class="range" data-w="@w" data-h="@h"><span>@text</span></li>',{text:i,w:r,h:o});e===an.active&&a.classList.add("active"),n.appendChild(a)}))};const ln=function(n,t,e,r){cn=n,an=r;var o=S('<div class="range-bg">\n    <div class="range-box">\n      <h3>선택영역</h3>\n      <div class="range-input">\n        <input type="text" placeholder="ex) 600 400" data-range-input>\n        <button data-range-add>ADD</button>\n      </div>\n      <ul class="range-list">\n      </ul>\n      <div class="footer">\n        <button data-range-close>CLOSE</button>\n      </div>\n    </div>\n  </div>',{});on=o,console.log(o),sn(),t.appendChild(on),z(on,(function(n){var t=n.target;I(t,"li.range",(function(n){var t=T(n,["w","h"]),e=an.options.findIndex((function(n){return n.width===t.w&&n.height===t.h}));an.active=e,sn(),cn.emit("range",{range:{width:t.w,height:t.h},active:e,save:!1})})),I(t,"[data-range-add]",(function(){var n,t,e=(n=j(on,"[data-range-input]").value.split(" ").map((function(n){return parseInt(n,10)})),t=2,function(n){if(Array.isArray(n))return n}(n)||function(n,t){var e=null==n?null:"undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null!=e){var r,o,i=[],a=!0,c=!1;try{for(e=e.call(n);!(a=(r=e.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(n){c=!0,o=n}finally{try{a||null==e.return||e.return()}finally{if(c)throw o}}return i}}(n,t)||function(n,t){if(n){if("string"==typeof n)return rn(n,t);var e=Object.prototype.toString.call(n).slice(8,-1);return"Object"===e&&n.constructor&&(e=n.constructor.name),"Map"===e||"Set"===e?Array.from(n):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?rn(n,t):void 0}}(n,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r={width:e[0],height:e[1]};an.options.push(r);var o=an.options.length-1;an.active=o,sn(),cn.emit("range",{range:r,active:o,save:!0})})),I(t,"[data-range-close]",(function(){on.remove()}))}))};var un=e(379),An=e.n(un),pn=e(795),hn=e.n(pn),fn=e(569),dn=e.n(fn),gn=e(565),vn=e.n(gn),bn=e(216),xn=e.n(bn),Cn=e(589),yn=e.n(Cn),mn=e(387),wn={};function En(n,t){(null==t||t>n.length)&&(t=n.length);for(var e=0,r=new Array(t);e<t;e++)r[e]=n[e];return r}function $n(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,r)}return e}function kn(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?$n(Object(e),!0).forEach((function(t){Bn(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):$n(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function Bn(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function zn(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}wn.styleTagTransform=yn(),wn.setAttributes=vn(),wn.insert=dn().bind(null,"head"),wn.domAPI=hn(),wn.insertStyleElement=xn(),An()(mn.Z,wn),mn.Z&&mn.Z.locals&&mn.Z.locals;var On={image:function(n){var t=new Image;return t.src=n,t},dataUrl:function(n){return n}},Sn=function(){function n(t,e,r,o){var i=this;!function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.canvas=t,this.selection=e,this.$$=kn({},r),this.eventBus=o,this.eventBus.on("sizebox",(function(n){ln(i.eventBus,i.$$.rootWrapper,0,i.getConfig("ranges"))})),this.eventBus.on("range",(function(n){var t=n.range,e=n.save;i.selection.mergeSelection(t),e&&i.$$.config.ranges.push("".concat(t.width,"x").concat(t.height))}))}var t,e;return t=n,(e=[{key:"setConfig",value:function(n,t){var e=this.canvas.config;if(!Object.prototype.hasOwnProperty.call(e,n))throw new Error("no such config [".concat(n,"]"));e[n]=t,this.eventBus.emit("config-updated",{key:n,value:t})}},{key:"getConfig",value:function(n){return this.canvas.config[n]}},{key:"capture",value:function(n,t){var e=n||this.getConfig("range"),r=this.canvas.copyImageAt(e),o=r.indexOf(","),i=parseInt(.75*(r.length-(o+1)),10),a=t||"image";return{image:On[a](r),type:a,meta:kn({size:i},n)}}},{key:"setRange",value:function(n){this.setConfig("range",n)}},{key:"openImage",value:function(n){var t,e,r=this;return(t=n,e=new FileReader,new Promise((function(n){e.addEventListener("load",(function(){var r=document.createElement("img");r.src=e.result,n({file:t,img:r})})),e.readAsDataURL(t)}))).then((function(n){console.log(n);var t=n.file,e=n.img,o={size:t.size,type:t.type,width:e.width,height:e.height};return r.canvas.setImage(n.img,o),r.selection.setVisible(!0),o}))}}])&&zn(t.prototype,e),n}(),jn=function(n){var t={ratio:1,width:400,height:400,fitMode:"none",captureOn:"viewport",ranges:{options:["100x100","200x200","300x300"],active:1},range:{x:30,y:30,width:100,height:100}};Object.assign(t,n),function(n){return!n}(t)&&alert("error");var e=t.ranges,r=function(n){return parseInt(n,10)},o=e.options.map((function(n){var t,e,o=(t=n.split("x").map(r),e=2,function(n){if(Array.isArray(n))return n}(t)||function(n,t){var e=null==n?null:"undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null!=e){var r,o,i=[],a=!0,c=!1;try{for(e=e.call(n);!(a=(r=e.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(n){c=!0,o=n}finally{try{a||null==e.return||e.return()}finally{if(c)throw o}}return i}}(t,e)||function(n,t){if(n){if("string"==typeof n)return En(n,t);var e=Object.prototype.toString.call(n).slice(8,-1);return"Object"===e&&n.constructor&&(e=n.constructor.name),"Map"===e||"Set"===e?Array.from(n):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?En(n,t):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());return{width:o[0],height:o[1]}}));e.options=o;var i=e.options[e.active];t.range.width=i.width,t.range.height=i.height;var a=document.querySelector(t.el),c=v(".canvas-wrapper");return O(c,{width:t.width,height:t.height}),a.appendChild(c),new Promise((function(n){setTimeout((function(){var e=C(),r=new G(c,t,e),o=new en(c,t,e),i=new Sn(r,o,{rootWrapper:a,canvasWrapper:c,config:t},e);t.image&&g(t.image).then((function(n){i.setImage(n.img,n)})),n(i)}),0)}))};const In={init:jn}})(),r})()}));
//# sourceMappingURL=photoflex.js.map